machine:
  php:
    version: 7.0.4
  node:
    version: 6.1.0
  environment:
    WP_DEVELOP_DIR: /tmp/wordpress-tests-lib

database:
  override:
    - mysql -u ubuntu -e "create database wordpress_test"
    - mysql -u ubuntu -e "create user travis"
    - mysql -u ubuntu -e "grant all on wordpress_test.* to 'travis'@'localhost' identified by ''";

dependencies:
  pre:
    - composer config --list --global
    - export PATH=`composer config --list --global | grep '\[home\]' | { read a; echo "${a#* }/vendor/bin:$PATH"; }`
    - composer global require "phpunit/phpunit=5.7.*"
    - composer install
    - bash ./.tests/.bin/install-wp-tests.sh "wordpress_test" "travis" ""
    - mv $WP_DEVELOP_DIR/tests/phpunit/includes ./.tests/php
#    - echo "mysqli.default_socket = /var/run/mysqld/mysqld.sock" >> /opt/circleci/php/7.1.0/etc/php.ini
  override:
    - exit 0
  post:
  - wget https://phar.phpunit.de/phpunit-5.7.phar
  - chmod +x phpunit-5.7.phar
  - sudo mv phpunit-5.7.phar /usr/local/bin/phpunit

